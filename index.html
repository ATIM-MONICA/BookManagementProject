<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Manager</title>
    <link rel="stylesheet" href="./styles.css">
    <!-- Bootstrap CSS for styling -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- jQuery and Bootstrap JS for modal functionality -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container mt-5">
    <h1>Book Management System</h1>
    
    <!-- Search Books Section -->
    <div class="form-group mt-4">
        <label for="searchInput">Search Books</label>
        <div class="input-group">
            <input type="text" id="searchInput" class="form-control" placeholder="Search by title or author">
            <div class="input-group-append">
                <button id="searchBookBtn" class="btn btn-outline-secondary" type="button">Search</button>
            </div>
        </div>
    </div>

    <!-- Button to open the modal for adding a new book -->
    <button id="addBookBtn" class="btn btn-primary">Add Book</button>

    <!-- Sections for displaying books based on their categories -->
    <h2 class="mt-4">Favorite Books</h2>
    <ul id="favoriteList" class="list-group"></ul>

    <h2 class="mt-4">Read Books</h2>
    <ul id="readList" class="list-group"></ul>

    <h2 class="mt-4">Unread Books</h2>
    <ul id="unreadList" class="list-group"></ul>
</div>

<!-- Add Book Modal -->
<div class="modal fade" id="addBookModal" tabindex="-1" role="dialog" aria-labelledby="addBookModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addBookModalLabel">Add New Book</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addBookForm">
                    <div class="form-group">
                        <label for="bookTitle">Title</label>
                        <input type="text" class="form-control" id="bookTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="bookAuthor">Author</label>
                        <input type="text" class="form-control" id="bookAuthor" required>
                    </div>
                    <div class="form-group">
                        <label for="bookCategory">Category</label>
                        <select class="form-control" id="bookCategory" required>
                            <option value="" disabled selected>Select category</option>
                            <option value="unread">Unread</option>
                            <option value="read">Read</option>
                            <option value="favorite">Favorite</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" id="saveBookBtn" class="btn btn-primary">Save Book</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Initialize an empty array to hold the books
    let books = JSON.parse(localStorage.getItem('books')) || [];

    // Function to save the books array to local storage
    function saveBooksToLocalStorage() {
        localStorage.setItem('books', JSON.stringify(books)); // Save the books array
    }

    // Function to load books from local storage on page load
    function loadBooksFromLocalStorage() {
        const storedBooks = JSON.parse(localStorage.getItem('books'));
        if (storedBooks) {
            books = storedBooks; // Initialize books
                        // Initialize books array with stored data
                        displayBooks(); // Display the books
                    }
                }
            
                // Function to display books in the UI, categorized by their category
                function displayBooks() {
                    // Clear existing lists
                    document.getElementById('favoriteList').innerHTML = '';
                    document.getElementById('readList').innerHTML = '';
                    document.getElementById('unreadList').innerHTML = '';
            
                    // Loop through each book and append it to the appropriate category list
                    books.forEach(book => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                        listItem.textContent = `${book.title} by ${book.author}`;
                        listItem.setAttribute('data-id', book.id); // Set data attribute for editing/deleting
            
                        // Create edit button
                        const editButton = document.createElement('button');
                        editButton.className = 'btn btn-warning btn-sm';
                        editButton.textContent = 'Edit';
                        editButton.onclick = () => openEditModal(book.id); // Open edit modal on click
            
                        // Create delete button
                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'btn btn-danger btn-sm';
                        deleteButton.textContent = 'Delete';
                        deleteButton.onclick = () => deleteBook(book.id); // Call deleteBook function on click
            
                        // Append the edit and delete buttons to the list item
                        listItem.appendChild(editButton);
                        listItem.appendChild(deleteButton);
            
                        // Append the list item to the appropriate category list
                        if (book.category === 'favorite') {
                            document.getElementById('favoriteList').appendChild(listItem);
                        } else if (book.category === 'read') {
                            document.getElementById('readList').appendChild(listItem);
                        } else if (book.category === 'unread') {
                            document.getElementById('unreadList').appendChild(listItem);
                        }
                    });
                }
            
                // Function to add a new book
                function addBook(book) {
                    books.push(book); // Add the new book to the array
                    saveBooksToLocalStorage(); // Save updated books to local storage
                    displayBooks(); // Refresh the UI to show the new book
                }
                
                // Function to edit a book
                function editBook(id, updatedBook) {
                    const index = books.findIndex(book => book.id === id); // Find the index of the book to edit
                    if (index !== -1) {
                        books[index] = updatedBook; // Update the book details
                        saveBooksToLocalStorage(); // Save changes to local storage
                        displayBooks(); // Refresh the UI
                    }
                }
            
                // Function to delete a book
                function deleteBook(id) {
                    books = books.filter(book => book.id !== id); // Remove the book from the array
                    saveBooksToLocalStorage(); // Update local storage
                    displayBooks(); // Refresh the UI
                }
            
                // Function to open the edit modal and populate it with the book details
                function openEditModal(id) {
                    const bookToEdit = books.find(book => book.id === id); // Find the book to edit
                    if (bookToEdit) {
                        document.getElementById('bookTitle').value = bookToEdit.title; // Populate title
                        document.getElementById('bookAuthor').value = bookToEdit.author; // Populate author
                        document.getElementById('bookCategory').value = bookToEdit.category; // Populate category
            
                        // Change the save button to update the book instead of adding a new one
                        document.getElementById('saveBookBtn').onclick = () => {
                            const updatedBook = {
                                id: bookToEdit.id, // Keep the same ID
                                title: document.getElementById('bookTitle').value,
                                author: document.getElementById('bookAuthor').value,
                                category: document.getElementById('bookCategory').value
                            };
                            editBook(bookToEdit.id, updatedBook); // Call editBook function
                            $('#addBookModal').modal('hide'); // Hide the modal
                            document.getElementById('addBookForm').reset(); // Reset the form
                        };
            
                        $('#addBookModal').modal('show'); // Show the modal
                    }
                }
            
                // Event listener for the "Add Book" button to show the modal
                document.getElementById('addBookBtn').addEventListener('click', () => {
                    // Reset the form and set the save button to add a new book
                    document.getElementById('addBookForm').reset();
                    document.getElementById('saveBookBtn').onclick = () => {
                        const newBook = {
                            id: Date.now(), // Unique ID for the book
                            title: document.getElementById('bookTitle').value,
                            author: document.getElementById('bookAuthor').value,
                            category: document.getElementById('bookCategory').value
                        };
                        addBook(newBook); // Call the addBook function
                        $('#addBookModal').modal('hide'); // Hide the modal
                    };
                    $('#addBookModal').modal('show'); // Show the modal
                });
            
                // Event listener for the search button
                document.getElementById('searchBookBtn').addEventListener('click', () => {
                    const searchTerm = document.getElementById('searchInput').value.toLowerCase(); // Get the search term
                    const filteredBooks = books.filter(book => 
                        book.title.toLowerCase().includes(searchTerm) || 
                        book.author.toLowerCase().includes(searchTerm)
                    ); // Filter books based on the search term
            
                    // Clear existing lists
                    document.getElementById('favoriteList').innerHTML = '';
                    document.getElementById('readList').innerHTML = '';
                    document.getElementById('unreadList').innerHTML = '';
            
                    // Display filtered books
                    filteredBooks.forEach(book => {
                        const listItem = document.createElement('li');
                        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                        listItem.textContent = `${book.title} by ${book.author}`;
                        listItem.setAttribute('data-id', book.id); // Set data attribute for editing/deleting
            
                        // Create edit button
                        const editButton = document.createElement('button');
                        editButton.className = 'btn btn-warning btn-sm';
                        editButton.textContent = 'Edit';
                        editButton.onclick = () => openEditModal(book.id); // Open edit modal on click
            
                        // Create delete button
                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'btn btn-danger btn-sm';
                        deleteButton.textContent = 'Delete';
                        deleteButton.onclick = () => deleteBook(book.id); // Call deleteBook function on click
            
                        // Append the edit and delete buttons to the list item
                        listItem.appendChild(editButton);
                        listItem.appendChild(deleteButton);
            
                        // Append the list item to the appropriate category list
                        if (book.category === 'favorite') {
                            document.getElementById('favoriteList').appendChild(listItem);
                        } else if (book.category === 'read') {
                            document.getElementById('readList').appendChild(listItem);
                        } else if (book.category === 'unread') {
                            document.getElementById('unreadList').appendChild(listItem);
                        }
                    });
                });
            
                // Load existing books from local storage on page load
                loadBooksFromLocalStorage();
            </script>
            
            </body>
            </html>
                        